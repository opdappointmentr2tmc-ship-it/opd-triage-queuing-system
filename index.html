<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Queuing System</title>
<style>
* { box-sizing: border-box; margin:0; padding:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: #f4f4f4; display: flex; flex-wrap: wrap; justify-content: center; align-items: stretch; height: 100vh; gap: 10px; padding: 10px; }

/* COUNTERS */
.computer { flex: 1 1 calc(33.333% - 20px); min-width: 300px; border-radius: 20px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.2); display: flex; flex-direction: column; justify-content: space-between; padding: 20px; transition: background 0.3s, border 0.3s, transform 0.2s, box-shadow 0.2s; }
.computer.green { background-color:#d4edda; border:10px solid #28a745; }
.computer.green:hover { box-shadow: 0 10px 20px rgba(40,167,69,0.5); transform: translateY(-3px); }
.computer.red { background-color:#f8d7da; border:10px solid #dc3545; }
.computer.red:hover { box-shadow: 0 10px 20px rgba(220,53,69,0.5); transform: translateY(-3px); }

.title { font-size: 30px; font-weight: bold; }
.queue-number { font-size: clamp(80px, 15vw, 200px); font-weight: bold; color: #222; min-height: 200px; display:flex; justify-content:center; align-items:center; transition: color 0.3s, transform 0.3s, opacity 0.3s; }
.queue-number.done { color: #888; font-size: clamp(60px, 15vw, 150px); font-style: italic; font-weight: bold; display:flex; justify-content:center; align-items:center; }
.queue-label { font-size: 20px; margin-top: 10px; font-weight: bold; }

/* BUTTONS */
button { padding: 15px 25px; margin: 5px; border: none; border-radius: 10px; cursor: pointer; font-size: 18px; font-weight: bold; transition: all 0.2s ease; }
.next-btn { background-color: #007bff; color: white; }
.done-btn { background-color: #6c757d; color: white; }
.transpose-btn { background-color: #ffc107; color: black; }
.reset-btn { background-color: #dc3545; color: white; }
.change-btn { background-color: #17a2b8; color: white; }
button:disabled { opacity: 0.5; cursor: not-allowed; }
button:hover:not(:disabled) { opacity: 0.9; transform: translateY(-2px); }

/* OVERLAYS */
#selection-overlay, #admin-login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column; z-index:9999; background: rgba(0,0,0,0.85); }
.overlay-box { background:white; padding:40px 30px; border-radius:20px; text-align:center; min-width:300px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display:flex; flex-direction:column; align-items:center; gap:20px; }
#selection-overlay h2, #admin-login-overlay h2 { margin-bottom:20px; font-size:28px; color:#333; }
#selection-overlay button, #admin-login-overlay button { width:220px; padding:12px; font-size:18px; border-radius:12px; font-weight:bold; box-shadow: 0 4px 8px rgba(0,0,0,0.15); transition: all 0.2s; }
#selection-overlay button:hover, #admin-login-overlay button:hover { transform: translateY(-3px); box-shadow: 0 6px 12px rgba(0,0,0,0.25); }
#admin-login-overlay { display:none; color:black; }
#admin-login-overlay input, #admin-login-overlay select { width:90%; padding:12px; margin:5px 0; font-size:16px; border-radius:10px; border:1px solid #ccc; text-align:center; outline:none; box-shadow: inset 0 2px 6px rgba(0,0,0,0.05); transition: all 0.2s; }

/* ADMIN PANEL */
#admin-panel { display:none; background:#fff; padding:30px; border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.15); margin-top:20px; width:320px; }
#admin-panel h3 { margin-bottom:20px; font-size:22px; color:#333; }
.admin-grid { display:flex; flex-direction:column; gap:15px; }
.admin-grid label { font-weight:bold; font-size:16px; color:#555; margin-bottom:5px; }
.admin-grid input, .admin-grid select { font-size:16px; padding:12px; border-radius:10px; border:1px solid #ccc; outline:none; text-align:center; box-shadow: inset 0 2px 6px rgba(0,0,0,0.05); transition: all 0.2s; }

/* SELECTION BUTTONS VERTICAL */
#selection-overlay div { display: flex; flex-direction: column; gap: 15px; align-items: center; }

/* ANIMATION */
@keyframes numberPop { 0% { transform: scale(1); opacity:0.5; } 50% { transform: scale(1.4); opacity:1; } 100% { transform: scale(1); opacity:1; } }
.queue-number.animate { animation: numberPop 0.4s ease; }
</style>
</head>
<body>

<!-- SELECTION OVERLAY -->
<div id="selection-overlay">
  <div class="overlay-box">
    <h2>Select Your Counter or Admin</h2>
    <div>
      <button onclick="selectCounter(1)">Counter 1</button>
      <button onclick="selectCounter(2)">Counter 2</button>
      <button onclick="selectCounter(3)">Counter 3</button>
      <button onclick="selectCounter(4)">Counter 4</button>
      <button onclick="selectCounter(5)">Counter 5</button>
      <button onclick="showAdminLogin()">Admin</button>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN OVERLAY -->
<div id="admin-login-overlay">
  <div class="overlay-box">
    <h2>Admin Login</h2>
    <input type="text" id="adminUser" placeholder="Username"><br>
    <input type="password" id="adminPass" placeholder="Password"><br>
    <button onclick="loginAdmin()">Login</button>
    <p id="adminError" style="color:red;margin-top:10px;display:none;">Incorrect username or password</p>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="admin-panel">
  <h3>Set Lane Numbers</h3>
  <div class="admin-grid">
    <label>Lane Type</label>
    <select id="laneSelect">
      <option value="green">Regular Lane</option>
      <option value="red">Priority Lane</option>
    </select>
    <label>Counter</label>
    <select id="counterSelect">
      <option value="1">Counter 1</option>
      <option value="2">Counter 2</option>
      <option value="3">Counter 3</option>
      <option value="4">Counter 4</option>
      <option value="5">Counter 5</option>
    </select>
    <label>Number</label>
    <input type="number" id="numberInput" placeholder="Enter Number">
    <button class="change-btn" onclick="setNumber()">Set Number</button>
  </div>
  <div style="margin-top:20px; text-align:center;">
    <button class="reset-btn" onclick="resetQueues()">RESET QUEUES</button>
    <button class="change-btn" onclick="showSelectionOverlay()">Change Counter</button>
  </div>
</div>

<!-- COUNTERS -->
<div class="computer green" id="comp1">
  <div class="title">Counter 1</div>
  <div class="queue-number" id="queue1">0</div>
  <div class="queue-label" id="label1">REGULAR LANE</div>
  <div>
    <button class="next-btn" id="next1" onclick="nextQueue(1)">Next</button>
    <button class="done-btn" id="done1" onclick="doneQueue(1)">Done</button>
    <button class="transpose-btn" id="transpose1" onclick="transposeQueue(1)">Transpose</button>
  </div>
</div>
<div class="computer green" id="comp2">
  <div class="title">Counter 2</div>
  <div class="queue-number" id="queue2">0</div>
  <div class="queue-label" id="label2">REGULAR LANE</div>
  <div>
    <button class="next-btn" id="next2" onclick="nextQueue(2)">Next</button>
    <button class="done-btn" id="done2" onclick="doneQueue(2)">Done</button>
    <button class="transpose-btn" id="transpose2" onclick="transposeQueue(2)">Transpose</button>
  </div>
</div>
<div class="computer green" id="comp3">
  <div class="title">Counter 3</div>
  <div class="queue-number" id="queue3">0</div>
  <div class="queue-label" id="label3">REGULAR LANE</div>
  <div>
    <button class="next-btn" id="next3" onclick="nextQueue(3)">Next</button>
    <button class="done-btn" id="done3" onclick="doneQueue(3)">Done</button>
    <button class="transpose-btn" id="transpose3" onclick="transposeQueue(3)">Transpose</button>
  </div>
</div>
<div class="computer red" id="comp4">
  <div class="title">Counter 4</div>
  <div class="queue-number" id="queue4">0</div>
  <div class="queue-label" id="label4">PRIORITY LANE</div>
  <div>
    <button class="next-btn" id="next4" onclick="nextQueue(4)">Next</button>
    <button class="done-btn" id="done4" onclick="doneQueue(4)">Done</button>
    <button class="transpose-btn" id="transpose4" onclick="transposeQueue(4)">Transpose</button>
  </div>
</div>
<div class="computer red" id="comp5">
  <div class="title">Counter 5</div>
  <div class="queue-number" id="queue5">0</div>
  <div class="queue-label" id="label5">PRIORITY LANE</div>
  <div>
    <button class="next-btn" id="next5" onclick="nextQueue(5)">Next</button>
    <button class="done-btn" id="done5" onclick="doneQueue(5)">Done</button>
    <button class="transpose-btn" id="transpose5" onclick="transposeQueue(5)">Transpose</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyA44lhpB7Um36IBUWLG98ICiDqAk",
  authDomain: "queuesystem-80ce7.firebaseapp.com",
  databaseURL: "https://queuesystem-80ce7-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "queuesystem-80ce7",
  storageBucket: "queuesystem-80ce7.appspot.com",
  messagingSenderId: "399130001823",
  appId: "1:399130001823:web:052ecfb12ae9007463bdaa"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let activeStatus = {1:false,2:false,3:false,4:false,5:false};
let colorStatus = {1:'green',2:'green',3:'green',4:'red',5:'red'};
let lastNumber = {1:0,2:0,3:0,4:0,5:0};
let myCounter = null;
let isAdmin = false;

// Disable buttons initially
window.onload = () => {
  for(let i=1;i<=5;i++){
    document.getElementById(`next${i}`).disabled = true;
    document.getElementById(`done${i}`).disabled = true;
    document.getElementById(`transpose${i}`).disabled = true;
  }
};

// Counter selection
function selectCounter(id){
  myCounter = id;
  isAdmin = false;
  for(let i=1;i<=5;i++){
    document.getElementById(`comp${i}`).style.display = (i===id)?'flex':'none';
    activeStatus[i] = false;
  }
  document.getElementById(`next${id}`).disabled = false;
  document.getElementById(`done${id}`).disabled = true;
  document.getElementById(`transpose${id}`).disabled = true;
  document.getElementById('selection-overlay').style.display='none';
}

function showSelectionOverlay(){
  document.getElementById('selection-overlay').style.display='flex';
  for(let i=1;i<=5;i++){
    document.getElementById(`comp${i}`).style.display='flex';
  }
}

function showAdminLogin(){
  document.getElementById('selection-overlay').style.display='none';
  document.getElementById('admin-login-overlay').style.display='flex';
}

function loginAdmin(){
  const user=document.getElementById('adminUser').value;
  const pass=document.getElementById('adminPass').value;
  if(user==='a' && pass==='a'){
    isAdmin=true;
    myCounter=null;
    document.getElementById('admin-login-overlay').style.display='none';
    document.getElementById('admin-panel').style.display='block';
    for(let i=1;i<=5;i++){
      document.getElementById(`comp${i}`).style.display='flex';
      document.getElementById(`next${i}`).disabled=false;
      document.getElementById(`done${i}`).disabled=false;
      document.getElementById(`transpose${i}`).disabled=false;
    }
  } else {
    document.getElementById('adminError').style.display='block';
  }
}

// Animate numbers
function animateNumber(numEl){
  numEl.classList.add('animate');
  setTimeout(()=>{ numEl.classList.remove('animate'); },400);
}

// Next queue
function nextQueue(id){
  if(myCounter!==id && !isAdmin) return;
  if(activeStatus[id]) return;
  const color=colorStatus[id];
  db.ref(`/series/${color}`).transaction(current=>(current||0)+1,(err,committed,snap)=>{
    if(committed){
      const numEl=document.getElementById(`queue${id}`);
      lastNumber[id]=snap.val();
      numEl.textContent=snap.val();
      numEl.classList.remove('done');
      animateNumber(numEl);
      activeStatus[id]=true;
      document.getElementById(`next${id}`).disabled=true;
      document.getElementById(`done${id}`).disabled=false;
      document.getElementById(`transpose${id}`).disabled=true;
      updateDashboard(id,snap.val());
    }
  });
}

// Done queue
function doneQueue(id){
  if(myCounter!==id && !isAdmin) return;
  const numEl=document.getElementById(`queue${id}`);
  if(!lastNumber[id]) return;
  numEl.textContent='DONE';
  numEl.classList.add('done');
  activeStatus[id]=false;
  document.getElementById(`next${id}`).disabled=false;
  document.getElementById(`done${id}`).disabled=true;
  document.getElementById(`transpose${id}`).disabled=false;
  updateDashboard(id,lastNumber[id]);
}

// Transpose queue
function transposeQueue(id){
  if(myCounter!==id && !isAdmin) return;
  const comp=document.getElementById(`comp${id}`);
  const label=document.getElementById(`label${id}`);
  const currentColor=colorStatus[id];
  const newColor=currentColor==='green'?'red':'green';
  label.textContent=newColor==='green'?'REGULAR LANE':'PRIORITY LANE';
  comp.classList.remove(currentColor);
  comp.classList.add(newColor);
  colorStatus[id]=newColor;
  db.ref(`/series/${newColor}`).transaction(current=>(current||0)+1,(err,committed,snap)=>{
    if(committed){
      const numEl=document.getElementById(`queue${id}`);
      lastNumber[id]=snap.val();
      numEl.textContent=snap.val();
      numEl.classList.remove('done');
      animateNumber(numEl);
      activeStatus[id]=true;
      document.getElementById(`next${id}`).disabled=true;
      document.getElementById(`done${id}`).disabled=false;
      document.getElementById(`transpose${id}`).disabled=true;
      updateDashboard(id,snap.val());
    }
  });
}

// Reset queues
function resetQueues(){
  if(!isAdmin) return;
  if(!confirm("Reset all series to 0?")) return;
  db.ref('/series/green').set(0);
  db.ref('/series/red').set(0);
  for(let i=1;i<=5;i++){
    const numEl=document.getElementById(`queue${i}`);
    numEl.textContent=0;
    numEl.classList.remove('done');
    activeStatus[i]=false;
    lastNumber[i]=0;
    const comp=document.getElementById(`comp${i}`);
    comp.classList.remove('green','red');
    comp.classList.add(colorStatus[i]);
    document.getElementById(`label${i}`).textContent=colorStatus[i]==='green'?'REGULAR LANE':'PRIORITY LANE';
    document.getElementById(`next${i}`).disabled=false;
    document.getElementById(`done${i}`).disabled=true;
    document.getElementById(`transpose${i}`).disabled=true;
    updateDashboard(i,0);
  }
}

// Set number manually from admin
function setNumber(){
  const lane = document.getElementById('laneSelect').value;
  const counter = parseInt(document.getElementById('counterSelect').value);
  const number = parseInt(document.getElementById('numberInput').value);
  if(isNaN(number)) return alert("Please enter a valid number");
  lastNumber[counter] = number;
  colorStatus[counter] = lane;
  const numEl = document.getElementById(`queue${counter}`);
  numEl.textContent = number;
  numEl.classList.remove('done');
  const comp = document.getElementById(`comp${counter}`);
  comp.classList.remove('green','red');
  comp.classList.add(lane);
  document.getElementById(`label${counter}`).textContent = lane==='green'?'REGULAR LANE':'PRIORITY LANE';
  db.ref(`/series/${lane}`).set(number);
  updateDashboard(counter, number);
  animateNumber(numEl);
  document.getElementById('numberInput').value = '';
}

// Update dashboard
function updateDashboard(id, number){
  const label=document.getElementById(`label${id}`).textContent;
  db.ref(`/computers/${id}`).set({number:number,color:colorStatus[id],label:label});
}
</script>
</body>
</html>
